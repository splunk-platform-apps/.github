name: Triage Issues

on:
  workflow_call:
    inputs:
      issue_number:
        required: true
        type: number
      issue_labels:
        required: true
        type: string

permissions:
  issues: write

jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
      - name: Classify issue by template
        id: classify
        run: |
          # Convert input labels to lowercase for easier matching
          labels="${{ inputs.issue_labels }}"
          labels_lower=$(echo "$labels" | tr '[:upper:]' '[:lower:]')

          template=""
          if echo "$labels_lower" | grep -qw "bug"; then
            echo "‚úÖ 'bug' label found."
            echo "labels=type: bug" >> $GITHUB_OUTPUT
            echo "comment=üëã Thanks for reporting a bug! We will triage this issue and come back to you into 2-5 business days." >> $GITHUB_OUTPUT
          elif echo "$labels_lower" | grep -qw "enhancement"; then
            echo "‚úÖ 'enhancement' label found."
            echo "labels=type: feature" >> $GITHUB_OUTPUT
            echo "comment=üöÄ Thanks for suggesting a new feature! We will triage this issue and come back to you into 2-5 business days." >> $GITHUB_OUTPUT
          else
            echo "‚ùå Could not classify the template based on given labels: $labels"
            exit 1
          fi

      - name: Add issue types
        uses: actions-ecosystem/action-add-labels@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: ${{ steps.classify.outputs.labels }}

      - name: Comment on issue
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ inputs.issue_number }}
          body: ${{ steps.classify.outputs.comment }}
